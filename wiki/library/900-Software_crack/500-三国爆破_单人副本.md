三国爆破系列 - 单人副本
=======================

准备阶段
--------

1.	三国Server端
2.	皇朝服务控制器
3.	Cheat Engine(CE) 6.5 -- 找基址
4.	OllDbg -- 分析逻辑，确定爆破

启动服务
--------

使用皇朝服务控制器。启动以下服务端程序，其中两个MAP服务中必须要有一个是包含有副本地图的。 当前配置中副本地图所在Map在1-5里面。

![启动服务列表](assets/900/500-3304d893.png)

启动游戏，登陆4个游戏账号
-------------------------

所有角色组队选择进入到长坂坡副本，队长不停地找 **说书人** 表示要进入副本：

![游戏窗口排列](assets/900/500-82e1ff98.png)

用 CE 加载副本地图所在MAP，就是 1-5 MAP
---------------------------------------

![选择进程](assets/900/500-e187b138.png)

![附加进程后的状态](assets/900/500-6a9fc8ee.png)

确定记录组队人数的虚拟地址
--------------------------

### 我们是四人组队，所以先紧缺搜索数值 4

![首次扫描](assets/900/500-4a69ed7d.png)

此时会搜出很多结果，不要慌，接着操作。

### 踢掉一个队员，改变组队人数，队长再次找 **说书人** 表示要进入副本，然后 **再次扫描** 数值 3

![再次扫描](assets/900/500-97d1e0bf.png)

此时只显示有三个接单，但是我们还是不清楚具体是哪个地址

![扫描结果](assets/900/500-05bc93ab.png)

### 再踢掉一个队员，继续改变组队人数，队长再次找 **说书人** 表示要进入副本，然后 **再次扫描** 数值 2

此时可以看到其中有一个结果的值变成了 2 (02CE3FF4)，这个只是组队人数，而且变红了，那就是这个值了，跑不了了，离成功不远了

这个地址是虚拟地址，程序每次运行都肯那个不一样。

（如果此时结果还是很多，那就多重复几次以上操作）

![跟踪数值变化的结果](assets/900/500-7f92f99d.png)

### 把结果添加到跟踪地址清单里

![把结果地址添加到地址清单](assets/900/500-f4721f6d.png)

因为我们是要找到逻辑地址，所以我们不需要寻找基址，直接打开 OllDbg 跳转到找到的虚拟地址。

寻找判断组队人数不足6人的逻辑代码
---------------------------------

### 打开 OllDbg ， 并且附加 1-5 Map 进程

此时可能会出现暂停的现象，导致账号全部掉线，解决办法就是，在最开始的就用 OllDbg 启动Map程序，然后用CE找到虚拟地址后，再用OllDbg来分析

手速快一点，在附加好了进程后，立即点击运行也不会出现问题。

### 按Ctrl+G跳转到我们已经找到的与你地址

![跳转到虚拟地址](assets/900/500-f596f348.png)

### 右键->数据窗口中跟随->选择 把该地址加入到数据跟随

![加入到数据跟随窗口](assets/900/500-55bb401a.png)

![就是我们要的02](assets/900/500-36ed0873.png)

### 右键选中 02 这个值，选择 断点->内存， 选择读取与写入访问权限

![设置内存断点](assets/900/500-1ca03a19.png)

确定后分分钟给段下来了，说明一直有读取操作，这样就导致所有账号都断线了，之后就不会有断点产生了，而且可以知道，这个断点位置并不是我们要找的

![被断下来了](assets/900/500-eed9a9b0.png)

**What a pity.** 我觉得应该有屏蔽部分终端的方法，让我找找先

*没找到怎么屏蔽部分访问的方法，选择另一张苦力劳动好了。。。阿西吧*

在OllDbg中右键选择查找->所有常量 填写5， 因为组队要求5人
--------------------------------------------------------

还好 cmp xxx,5 的也不是很多，百八十个吧，去他妹的。

### 选中每一个cmp x,5 的，点进去看看大致的说明

对于不明确的就F2断点，然后去游戏窗口上和 **说书人** 对话，如果被断下来那肯定就是它了。

![cmp with 5](assets/900/500-f52cd02a.png)

反反复复的无聊的断点+多话，做了100次左右，然后...我找到了.... 呵呵呵

没有费很多力气。。。

![找到了代码位置](assets/900/500-9966b804.png)

爆破修改
--------

### 首先确定了代码地址在： 00431F7D (副本最少人数)

随便改一下讨敌50就公告，代码地址：0045820B

修改副本限制人数为3人：双击代码位置，把 cmp ebp,5 修改成 cmp ebp,3

修改讨敌公告人数为50：mov ecx,64 改成 mov ecx,32

### 保存修改：右键->编辑->复制所有修改到可执行文件

![保存修改](assets/900/500-2b6a1dbb.png)

### 执行保存，直接右键->保存所有修改

小结
----

就是这么溜！！！

So easy！
